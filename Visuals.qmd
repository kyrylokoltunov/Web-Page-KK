---
title: "Visuals"
---

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(maps)
library(sf)
library(leaflet)
library(poliscidata)
library(viridis)
```


```{r}
raw.data <- as_tibble(poliscidata::states)

us_info <- raw.data |>
  transmute(
    state_name = state |>
      as.character() |>
      str_squish() |>
      str_replace_all("([a-z])([A-Z])", "\\1 \\2") |>
      str_to_lower(), ar = abort_rate08, religiosity  = religiosity3) |>
      filter(!state_name %in% c("hawaii","alaska"))

states_polygon <- as_tibble(map_data("state")) |>
  select(lat, region, group,long, order)

static_merge <- states_polygon |>
  inner_join(us_info, by = c("region" = "state_name"))

static_merge$religiosity <- factor(
  static_merge$religiosity,
  levels = c("Low","Mid","High")
)

ggplot(static_merge, aes(long, lat, group = group, fill = ar)) +
  geom_polygon(color = "grey30", linewidth = 0.2) +
  coord_map() +
  theme_void() +
  scale_fill_viridis_c(option = "inferno") +
  labs(
    title = "Abortion Rate in 2008",
    fill = "Abortions per 1,000",
    caption = "Janda, K., Berry, W., & Bingham Powell, G. (2019)."
  )

us_full <- read_sf("https://rstudio.github.io/leaflet/json/us-states.geojson")

interactive_merge <- us_full |>
  mutate(
    state_name = name |>
      str_to_lower() |>
      str_replace_all("district of columbia","DC")
  ) |>
  inner_join(us_info, by = "state_name") |>
  filter(!name %in% c("Hawaii","Alaska"))

pal_abort <- colorNumeric(
  palette = "RdYlGn",
  domain = interactive_merge$ar
)

leaflet(interactive_merge) |>
  addTiles() |>
  setView(-96, 37.8, zoom = 4) |>
  addPolygons(
    fillColor = ~pal_abort(ar),
    color = "white",
    weight = 1,
    fillOpacity = 0.8,
    highlightOptions = highlightOptions(
      weight = 2, color = "#666",
      fillOpacity = 0.9, bringToFront = TRUE
    ),
    label = ~paste0(name, ": ", ar, " per 1,000 women")
  ) |>
  addLegend(
    pal = pal_abort,
    values = ~ar,
    title = "Abortion Rate",
    position = "bottomright"
  )

ggplot(static_merge, aes(long, lat, group = group, fill = religiosity)) +
  geom_polygon(color = "grey30", linewidth = 0.2) +
  coord_map() +
  theme_void() +
  scale_fill_brewer(palette = "Dark2") +
  labs(
    title = "Religiosity Level by State",
    fill = "Religiosity",
    caption = "Janda, K., Berry, W., & Bingham Powell, G. (2019)."
  )


pal_relig <- colorFactor(
  palette = "Set2",
  levels = c("Low","Mid","High"), 
  domain = interactive_merge$religiosity
)

leaflet(interactive_merge) |>
  addTiles() |>
  setView(-96, 37.8, zoom = 4) |>
  addPolygons(
    fillColor = ~pal_relig(religiosity),
    color = "white",
    weight = 1,
    fillOpacity = 0.8,
    highlightOptions = highlightOptions(
      weight = 2, color = "#666",
      fillOpacity = 0.9, bringToFront = TRUE
    ),
    label = ~paste0(name, ": ", religiosity)
  ) |>
  addLegend(
    pal = pal_relig,
    values = ~religiosity,
    title = "Religiosity Level",
    position = "bottomright"
  )

```


